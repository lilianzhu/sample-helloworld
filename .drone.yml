workspace:
  base: /workspace

clone:
  sample-helloworld.git:
    image: index.qiniu.com/spock/git-plugin:cs-proxy
    path: /workspace/sample-helloworld

pipeline:
  build:
    image: index.qiniu.com/spock/golang:1.7
    commands:
      - cd /workspace/sample-helloworld
      - mkdir -p cache
      - echo "helloworld" > /drone/cache/test.cache
      - cat test.cache
      - make build
      - make test
    cache:
      mount:
        - /drone/cache
    #volumes:
    #  - /cache/sample-helloworld/cache:/workspace/sample-helloworld/cache

  publish:
    image: index.qiniu.com/spock/docker-client
    commands:
      - curl -s http://spock.dev.qiniu.io/assets/env.sh -o env.sh && source ./env.sh
      - echo $SERVICE
      - echo $TAG

    

